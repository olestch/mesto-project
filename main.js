(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{A:()=>z});var t={baseUrl:"https://nomoreparties.co/v1/plus-cohort-10",headers:{authorization:"ab7c328c-05fc-438f-b52b-81143bcac0cd","Content-Type":"application/json"}};function n(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function o(e){e.target.classList.contains("popup")&&a(e.target)}function r(e){"Escape"===e.key&&a(document.querySelector(".popup_opened"))}function c(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r),document.addEventListener("click",o)}function a(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r),document.removeEventListener("click",o)}var u=document.querySelector("#card-template").content,i=document.querySelector(".js-popup-image"),s=i.querySelector(".popup__image"),l=i.querySelector(".popup__caption"),d=document.querySelector(".photo-grid");function p(e){d.prepend(e)}function f(e,t){t.textContent=e.length}function m(e,t,n){var o=!1;e.some((function(e){e._id===t&&(o=!0)})),o?n.classList.add("card__icon_active"):n.classList.remove("card__icon_active")}function v(e,o){var r=u.querySelector(".card").cloneNode(!0),a=r.querySelector(".card__image"),d=r.querySelector(".card__like-counter"),p=r.querySelector(".card__title"),v=r.querySelector(".card__delete-icon"),_=r.querySelector(".card__icon"),h=e.likes;return a.src=e.link,a.alt=e.name,p.textContent=e.name,f(h,d),m(h,o,_),_.addEventListener("click",(function(r){var c=function(e,t){var n="PUT";return e.forEach((function(e){e._id===t&&(n="DELETE")})),n}(h,o);(function(e,o){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(o),{method:e,headers:t.headers}).then((function(e){return n(e)}))})(c,e._id).then((function(e){f(h=e.likes,d),m(h,o,_)})).catch((function(e){console.log(e)}))})),o===e.owner._id?v.addEventListener("click",(function(o){var r;(r=e._id,fetch("".concat(t.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:t.headers}).then((function(e){return n(e)}))).then((function(){o.target.closest(".card").remove()})).catch((function(e){console.log(e)}))})):v.classList.add("card__delete-icon_satus_hidden"),a.addEventListener("click",(function(){c(i),s.src=e.link,s.alt=e.name,l.textContent=e.name})),r}var _=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(z.inactiveButtonClass),t.disabled=!1):(t.classList.add(z.inactiveButtonClass),t.disabled=!0)};function h(e,t){e.classList.add(t),e.disabled=!0}var y=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__name"),b=document.querySelector(".profile__about"),q=document.querySelector(".profile__avatar"),L=document.querySelector(".profile__avatar-edit-button"),E=document.querySelector(".profile__add-button"),C=document.querySelectorAll(".popup"),g=document.querySelector(".js-popup-card"),k=g.querySelector(".popup__form"),j=g.querySelector(".popup__submit"),U=g.querySelector("input[name=new-card-name]"),x=g.querySelector("input[name=new-card-link]"),A=document.querySelector(".js-popup-profile"),B=A.querySelector("input[name=profile-name]"),O=A.querySelector("input[name=profile-about]"),P=A.querySelector(".popup__submit"),T=A.querySelector(".popup__form"),w=document.querySelector(".js-popup-avatar"),D=w.querySelector("input[name=avatar-link]"),N=w.querySelector(".popup__submit"),J=w.querySelector(".popup__form"),H={},z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error"};function M(e){H.name=e.name,H.about=e.about,H.avatar=e.avatar,H.id=e._id}function F(e){S.textContent=e.name,b.textContent=e.about,q.src=e.avatar}function G(e,t){e.textContent=t}fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return n(e)})).then((function(e){M(e),F(H),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return n(e)})).then((function(e){e.reverse().forEach((function(e){return p(v(e,H.id))}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),y.addEventListener("click",(function(){c(A),B.value=H.name,O.value=H.about})),L.addEventListener("click",(function(){c(w)})),E.addEventListener("click",(function(){c(g)})),T.addEventListener("submit",(function(e){var o,r;e.preventDefault(),G(P,"Сохранине..."),(o=B.value,r=O.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return n(e)}))).then((function(e){M(e),F(e),a(A),h(P,z.inactiveButtonClass)})).catch((function(e){console.log(e)})).finally((function(){G(P,"Сохранить")}))})),J.addEventListener("submit",(function(e){var o;e.preventDefault(),G(N,"Сохранине..."),(o=D.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})}).then((function(e){return n(e)}))).then((function(e){M(e),F(e),a(w),h(N,z.inactiveButtonClass)})).catch((function(e){console.log(e)})).finally((function(){G(N,"Сохранить")}))})),k.addEventListener("submit",(function(e){var o,r;e.preventDefault(),G(j,"Сохранине..."),(o=U.value,r=x.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:r})}).then((function(e){return n(e)}))).then((function(e){p(v(e,H.id)),a(g),k.reset(),h(j,z.inactiveButtonClass)})).catch((function(e){console.log(e)})).finally((function(){G(j,"Сохранить")}))})),C.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup__btn-close")&&a(e)}))})),console.log(H.id),Array.from(document.querySelectorAll(z.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(z.inputSelector)),o=e.querySelector(z.submitButtonSelector);_(n,o),n.forEach((function(t){t.addEventListener("input",(function(){(function(e,t){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(z.inputErrorClass),o.classList.remove(z.errorClass),o.textContent=""}(e,t):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(z.inputErrorClass),r.textContent=n,r.classList.add(z.errorClass)}(e,t,t.validationMessage)})(e,t),_(n,o)}))}))}(e)}))})();